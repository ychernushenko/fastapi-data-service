<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>consumer package &#8212; FastAPI-Data-Service  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="consumer-package">
<h1>consumer package<a class="headerlink" href="#consumer-package" title="Link to this heading">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading">¶</a></h2>
</section>
<section id="module-consumer.main">
<span id="consumer-main-module"></span><h2>consumer.main module<a class="headerlink" href="#module-consumer.main" title="Link to this heading">¶</a></h2>
<p>Consumer service for processing messages from Pub/Sub and saving processed data to the database.</p>
<p>This module listens to a Google Pub/Sub topic, processes the received data,
and stores the processed results in the database.</p>
<dl class="py function">
<dt class="sig sig-object py" id="consumer.main.get_db">
<span class="sig-prename descclassname"><span class="pre">consumer.main.</span></span><span class="sig-name descname"><span class="pre">get_db</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_url</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'postgresql+pg8000://'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/consumer/main.html#get_db"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#consumer.main.get_db" title="Link to this definition">¶</a></dt>
<dd><p>Provides a database session for the specified database URL.</p>
<p>If the database URL is the default (Cloud SQL), it connects using the Google Cloud SQL Connector
to securely connect to the Cloud SQL instance. For testing, an SQLite database URL can be provided
to run tests without connecting to Cloud SQL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>database_url</strong> (<em>str</em>) – The database URL to connect to.</p>
</dd>
<dt class="field-even">Yields<span class="colon">:</span></dt>
<dd class="field-even"><p><em>sqlalchemy.orm.Session</em> – A session bound to the specified database.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="consumer.main.process_data">
<span class="sig-prename descclassname"><span class="pre">consumer.main.</span></span><span class="sig-name descname"><span class="pre">process_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_payload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#consumer.schema.DataPayload" title="consumer.schema.DataPayload"><span class="pre">DataPayload</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/consumer/main.html#process_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#consumer.main.process_data" title="Link to this definition">¶</a></dt>
<dd><p>Processes a data payload by calculating the mean and standard deviation,
then stores the results in the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_payload</strong> (<a class="reference internal" href="#consumer.schema.DataPayload" title="consumer.schema.DataPayload"><em>DataPayload</em></a>) – The data payload object to process.</p></li>
<li><p><strong>db_session</strong> (<em>Session</em>) – The database session used to add and commit data.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If the data list in data_payload is empty or invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="consumer.main.pubsub_consumer">
<span class="sig-prename descclassname"><span class="pre">consumer.main.</span></span><span class="sig-name descname"><span class="pre">pubsub_consumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_session</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/consumer/main.html#pubsub_consumer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#consumer.main.pubsub_consumer" title="Link to this definition">¶</a></dt>
<dd><p>Google Cloud Function entry point for processing Pub/Sub messages.</p>
<p>This function decodes the base64-encoded Pub/Sub message payload, parses it into
a DataPayload object, and processes the data by calculating statistical metrics,
which are then stored in the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>dict</em>) – The Pub/Sub message payload in base64 encoding.</p></li>
<li><p><strong>context</strong> (<em>google.cloud.functions.Context</em>) – Metadata for the event.</p></li>
<li><p><strong>db_session</strong> (<em>Session</em><em>, </em><em>optional</em>) – Optional database session for dependency injection.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If the message data is not properly formatted or fails to parse.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-consumer.models">
<span id="consumer-models-module"></span><h2>consumer.models module<a class="headerlink" href="#module-consumer.models" title="Link to this heading">¶</a></h2>
<p>Database models for FastAPI data processing service.</p>
<dl class="py class">
<dt class="sig sig-object py" id="consumer.models.ProcessedData">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">consumer.models.</span></span><span class="sig-name descname"><span class="pre">ProcessedData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/consumer/models.html#ProcessedData"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#consumer.models.ProcessedData" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Base</span></code></p>
<p>SQLAlchemy model for storing processed data.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="consumer.models.ProcessedData.id">
<span class="sig-name descname"><span class="pre">id</span></span><a class="headerlink" href="#consumer.models.ProcessedData.id" title="Link to this definition">¶</a></dt>
<dd><p>Primary key identifier.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="consumer.models.ProcessedData.utc_timestamp">
<span class="sig-name descname"><span class="pre">utc_timestamp</span></span><a class="headerlink" href="#consumer.models.ProcessedData.utc_timestamp" title="Link to this definition">¶</a></dt>
<dd><p>UTC timestamp of the data record.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>datetime</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="consumer.models.ProcessedData.mean">
<span class="sig-name descname"><span class="pre">mean</span></span><a class="headerlink" href="#consumer.models.ProcessedData.mean" title="Link to this definition">¶</a></dt>
<dd><p>Mean of the data values.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="consumer.models.ProcessedData.stddev">
<span class="sig-name descname"><span class="pre">stddev</span></span><a class="headerlink" href="#consumer.models.ProcessedData.stddev" title="Link to this definition">¶</a></dt>
<dd><p>Standard deviation of the data values.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id0">
<span class="sig-name descname"><span class="pre">id</span></span><a class="headerlink" href="#id0" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id1">
<span class="sig-name descname"><span class="pre">mean</span></span><a class="headerlink" href="#id1" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id2">
<span class="sig-name descname"><span class="pre">stddev</span></span><a class="headerlink" href="#id2" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id3">
<span class="sig-name descname"><span class="pre">utc_timestamp</span></span><a class="headerlink" href="#id3" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-consumer.schema">
<span id="consumer-schema-module"></span><h2>consumer.schema module<a class="headerlink" href="#module-consumer.schema" title="Link to this heading">¶</a></h2>
<p>Pydantic schemas for FastAPI data processing service.</p>
<dl class="py class">
<dt class="sig sig-object py" id="consumer.schema.DataPayload">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">consumer.schema.</span></span><span class="sig-name descname"><span class="pre">DataPayload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_stamp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/consumer/schema.html#DataPayload"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#consumer.schema.DataPayload" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseModel</span></code></p>
<p>Schema for the payload received in the /data endpoint.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="consumer.schema.DataPayload.time_stamp">
<span class="sig-name descname"><span class="pre">time_stamp</span></span><a class="headerlink" href="#consumer.schema.DataPayload.time_stamp" title="Link to this definition">¶</a></dt>
<dd><p>Timestamp of the data submission in ISO 8601 format.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="consumer.schema.DataPayload.data">
<span class="sig-name descname"><span class="pre">data</span></span><a class="headerlink" href="#consumer.schema.DataPayload.data" title="Link to this definition">¶</a></dt>
<dd><p>List of data values.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[float]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id4">
<span class="sig-name descname"><span class="pre">data</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#id4" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="consumer.schema.DataPayload.model_computed_fields">
<span class="sig-name descname"><span class="pre">model_computed_fields</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">ClassVar</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ComputedFieldInfo</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{}</span></em><a class="headerlink" href="#consumer.schema.DataPayload.model_computed_fields" title="Link to this definition">¶</a></dt>
<dd><p>A dictionary of computed field names and their corresponding <cite>ComputedFieldInfo</cite> objects.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="consumer.schema.DataPayload.model_config">
<span class="sig-name descname"><span class="pre">model_config</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">ClassVar</span><span class="p"><span class="pre">[</span></span><span class="pre">ConfigDict</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{}</span></em><a class="headerlink" href="#consumer.schema.DataPayload.model_config" title="Link to this definition">¶</a></dt>
<dd><p>Configuration for the model, should be a dictionary conforming to [<cite>ConfigDict</cite>][pydantic.config.ConfigDict].</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="consumer.schema.DataPayload.model_fields">
<span class="sig-name descname"><span class="pre">model_fields</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">ClassVar</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">FieldInfo</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'data':</span> <span class="pre">FieldInfo(annotation=List[float],</span> <span class="pre">required=True),</span> <span class="pre">'time_stamp':</span> <span class="pre">FieldInfo(annotation=str,</span> <span class="pre">required=True)}</span></em><a class="headerlink" href="#consumer.schema.DataPayload.model_fields" title="Link to this definition">¶</a></dt>
<dd><p>Metadata about the fields defined on the model,
mapping of field names to [<cite>FieldInfo</cite>][pydantic.fields.FieldInfo] objects.</p>
<p>This replaces <cite>Model.__fields__</cite> from Pydantic V1.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id5">
<span class="sig-name descname"><span class="pre">time_stamp</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#id5" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-consumer">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-consumer" title="Link to this heading">¶</a></h2>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">FastAPI-Data-Service</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">App</a></li>
<li class="toctree-l1"><a class="reference internal" href="swagger.html">Swagger</a></li>
<li class="toctree-l1"><a class="reference internal" href="curl_guide.html">User guide</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Yuri Chernushenko.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/consumer.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>